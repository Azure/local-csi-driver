# Name used for creating resources.
name: csi-local

image:
  baseRepo: mcr.microsoft.com
  driver:
    repository: /acstor/local-csi-driver
    tag:
    pullPolicy: IfNotPresent
  csiProvisioner:
    repository: /oss/v2/kubernetes-csi/csi-provisioner
    tag: v5.2.0
    pullPolicy: IfNotPresent
  csiAttacher:
    repository: /oss/v2/kubernetes-csi/csi-attacher
    tag: v4.8.1
    pullPolicy: IfNotPresent
  csiResizer:
    repository: /oss/v2/kubernetes-csi/csi-resizer
    tag: v1.13.2
    pullPolicy: IfNotPresent
  livenessProbe:
    repository: /oss/v2/kubernetes-csi/livenessprobe
    tag: v2.15.0
    pullPolicy: IfNotPresent
  nodeDriverRegistrar:
    repository: /oss/v2/kubernetes-csi/csi-node-driver-registrar
    tag: v2.13.0
    pullPolicy: IfNotPresent

kubernetesClusterDomain: cluster.local
daemonset:
  csiProvisioner:
    args:
    - --v=2
    - --csi-address=/csi/lvm.sock
    - --node-deployment
    - --http-endpoint=:8090
    - --retry-interval-start=1s
    - --retry-interval-max=30s
    - --worker-threads=100
    - --kube-api-qps=100
    - --kube-api-burst=200
    - --extra-create-metadata
    - --feature-gates=Topology=true
    - --strict-topology=true
    - --enable-capacity
    - --capacity-ownerref-level=1
    - --capacity-poll-interval=15s
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 10m
        memory: 64Mi
  csiRegistrar:
    args:
    - --v=2
    - --csi-address=/csi/lvm.sock
    - --kubelet-registration-path=/var/lib/kubelet/plugins/cns.io/lvm.sock
    - --http-endpoint=:8091
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 10m
        memory: 64Mi
  driver:
    args:
    - --nodeName=$(NODE_NAME)
    - --podName=$(POD_NAME)
    - --namespace=$(POD_NAMESPACE)
    - --csi-bind-address=unix:///csi/lvm.sock
    - --metrics-bind-address=:8080
    - --health-probe-bind-address=:8081
    - --worker-threads=100
    - --kube-api-qps=100
    - --kube-api-burst=200
    - --trace-address=jaeger-collector.observability.svc.cluster.local:4317
    - --trace-sample-rate=1000000
    - --trace-service-id=$(POD_NAME)
    - --metrics-secure=false
    - --v=2
    containerSecurityContext:
      allowPrivilegeEscalation: true
      capabilities:
        add:
        - SYS_ADMIN
      privileged: true
    image:
      repository: localcsidriver.azurecr.io/local-csi-driver/driver
      # When unset, uses the chart version as the tag.
      tag:
    imagePullPolicy: Always
    resources:
      limits:
        cpu: 500m
        memory: 600Mi
      requests:
        cpu: 10m
        memory: 64Mi
  lvmResizer:
    args:
    - --v=2
    - --csi-address=/csi/lvm.sock
    - --timeout=240s
    - --handle-volume-inuse-error=true
    - --http-endpoint=0.0.0.0:29756
    env:
      address: /csi/lvm.sock
    resources:
      limits:
        memory: 500Mi
      requests:
        cpu: 10m
        memory: 20Mi
  nodeSelector: {}
  podSecurityContext:
    seccompProfile:
      type: Unconfined
  serviceAccount:
    annotations: {}

# webhook configuration.
webhook:
  ephemeral:
    # Enables the ephemeral PVC validation webhook, which enforces that PVCs are
    # ephemeral, or that the `acstor.azure.com/accept-ephemeral-storage=true`
    # annotation is present.
    enabled: true
  hyperconverged:
    # Enables the hyperconverged pod mutation webhook. Required to allow pods to
    # recover (with empty volumes) after cluster restart if node names change.
    enabled: true
  service:
    ports:
    - port: 443
      protocol: TCP
      targetPort: 9443
    type: ClusterIP
